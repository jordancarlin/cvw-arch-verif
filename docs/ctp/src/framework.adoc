
== Framework

The Certification Framework is the tool to:

* select the appropriate tests for the DUT configuration
* build these tests for the DUT
* generate expected values specific to the DUT configuration parameters, using the reference model
* rebuild the tests in self-checking form
* check log files to confirm all required tests ran successfully on the DUT

The framework also provides developer tools to check that the tests hit 100% of the coverpoints, and
to run the tests on multiple simulators to check for consistency.

The user is responsible for providing the DUT, including a testbench that can read an ELF file,
run it on the DUT, and save console output to a log file. The DUT could be an RTL model, or it could
be silicon connected to memories and a serial console. The user is also responsible for
scripting that launches tests for all self-checking ELF files in a hierarchical directory.  For
a nontrivial RTL model, this generally is done in parallel on a server or compute farm.

*** riscof

=== Using the Framework

*** update all of this when it is ready

To use the Certification Framework:

1) Clone the certification repository

[source,bash]
git clone https://github.com/riscv-non-isa/riscv-arch-test

2) Change into the directory

[source,bash]
cd riscv-arch-test

3) Write your UDB configuration YAML for your DUT

*** See framework/examples/wally_rv64gc/udb.yaml for an example of an RVA22S64 profile
*** directions to configuration options
*** where to put it

4) Implement the trick box macros for your DUT

*** See framework/examples/wally_rv64gc/model_test.h for a trick box
See <<Custom Trick Box Hints>> for hints about customizing the trick box to your DUT.

5) Run the framework to produce ELFs for your DUT

[source, bash]
riscof run --config framework/examples/wally_rv64gc/udb.yaml

* Checks consistency of configuration
* Uses UDB to generate tools-specific configurations and build scripts
* Describe output file directories

6) Run the ELFs for your DUT on your testbench and produce log files

7) Run the framework to check that all required tests completed and passed

[source, bash]
riscof check --log ***

If all tests passed, you should see:

`Certification Successful: xxx test files passed`

8) Optional: confirm that the tests hit all of the coverpoints

[source, bash]
riscof coverage ***

9) Optional: run the tests on other simulators.

[source, bash]
riscof sim spike --configdir *** --elfdir ***
riscof sim qemu --configdir *** --elfdir ***
riscof sim whisper --configdir *** --elfdir ***
riscof sim imperasfpm --configdir *** --elfdir ***
riscof sim idl --configdir *** --elfdir ***

=== Test Regression

RISC-V is highly configurable, and there is a need to check that the coverpoints and tests work with all certifiable configurations.  Moreover, the spec, reference model, compiler, and other components are rapidly evolving, so the test plan is susceptible to bitrot, ceasing to run.

The framework also must provide a CTP regression feature.  It builds and runs all of the applicable tests on each profile nightly, looking for failures or coverage holes. It also generates a wide range of UDB configurations that vary the values of supported parameters.  It identifies the tests that are impacted by these parameters, and runs them in the nightly regression.

TO DO: define fully configured baseline configs, supported parameters
